# ────────────────────────────────────────────────────────────────
#  LEXI MODEL REGISTRY
#  Central routing table for all Stable Diffusion–family backends.
#  Defines base checkpoints, refiners, LoRAs, and task-level policies.
# ────────────────────────────────────────────────────────────────

bases:
  juggernaut_xl_v9:
    file: "Juggernaut-XL-v9.safetensors"
    family: "sdxl"
    strengths: ["portrait", "realistic", "skin", "fashion"]
    tags: ["fast", "ig-look", "good-hands"]
    default_cfg: 5.0
    default_steps: 28

  sdxl_base_1_0:
    file: "sd_xl_base_1.0.safetensors"
    family: "sdxl"
    strengths: ["general", "balanced"]
    tags: ["vanilla"]

refiners:
  sdxl_refiner_1_0:
    file: "sd_xl_refiner_1.0.safetensors"
    family: "sdxl"
    strengths: ["polish", "detail"]
    tags: ["safe-default"]
    default_refiner_strength: 0.28

loras:
  # ── Core Adapters ──────────────────────────────────────────────
  faceid_sdxl:
    file: "ip-adapter-faceid-plusv2_sdxl_lora.safetensors"
    kind: "adapter"
    strengths: ["identity", "likeness"]
    default_weights: {unet: 0.8, clip: 0.8}

  face_helper_sdxl:
    file: "face-helper-sdxl_lora.safetensors"
    kind: "adapter"
    strengths: ["face-detail", "likeness"]
    default_weights: {unet: 0.6, clip: 0.4}

  # ── Body & Outfit ──────────────────────────────────────────────
  hourglass_sdxl:
    file: "hourglassv2_SDXL.safetensors"
    kind: "body"
    strengths: ["curves"]
    default_weights: {unet: 0.5, clip: 0.3}

  crop_top_ilxl:
    file: "Outfit_soph-HankyHemCropTop-ILXL.safetensors"
    kind: "outfit"
    strengths: ["fashion"]
    default_weights: {unet: 0.75, clip: 0.35}

  # ── Eyes & Hair Detail ─────────────────────────────────────────
  eyes_detail_xl:
    file: "sdxl-eye-hanme_01.safetensors"
    kind: "detail"
    strengths: ["eyes", "micro-contrast"]
    default_weights: {unet: 0.5, clip: 0.35}

  eyes_iris_width_xl:
    file: "sdxl-eye-iris-width.safetensors"
    kind: "detail"
    strengths: ["iris-shape", "gaze"]
    default_weights: {unet: 0.45, clip: 0.3}

  hair_detailer_xl:
    file: "sdxl-hairdetailer_02.safetensors"
    kind: "hair"
    strengths: ["strand-detail", "shine"]
    default_weights: {unet: 0.55, clip: 0.3}

# ────────────────────────────────────────────────────────────────
# POLICIES
# Each task intent maps to:
#   - preferred base checkpoints
#   - whether to use a refiner
#   - which LoRAs/adapters to load
#   - default tuning knobs (cfg/steps/denoise)
#   - variation profiles (randomness intensity, jitter bands)
# ────────────────────────────────────────────────────────────────

policies:
  portrait.realistic:
    prefer_bases: ["juggernaut_xl_v9", "sdxl_base_1_0"]
    allow_refiner: true
    loras: ["faceid_sdxl", "face_helper_sdxl", "eyes_detail_xl", "hair_detailer_xl"]
    defaults:
      cfg: 5.3
      steps: 32
      denoise: 0.45
      variation:
        seed_mode: "fixed"
        jitter: {cfg: 0.08, steps: 2, denoise: 0.02}

  outfit_edit:
    prefer_bases: ["juggernaut_xl_v9"]
    allow_refiner: false
    loras: ["faceid_sdxl", "hourglass_sdxl", "hair_detailer_xl", "eyes_detail_xl"]
    defaults:
      cfg: 4.7
      steps: 26
      denoise: 0.75
      variation:
        seed_mode: "random"
        jitter: {cfg: 0.4, steps: 5, denoise: 0.08}

  img2img.masked_edit:
    # Used when applying inpaint masks to preserve identity regions (face/hair/body)
    prefer_bases: ["juggernaut_xl_v9"]
    allow_refiner: true
    loras:
      - "faceid_sdxl"
      - "face_helper_sdxl"
      - "eyes_detail_xl"
      - "hair_detailer_xl"
      - "hourglass_sdxl"
    defaults:
      cfg: 5.0
      steps: 28
      denoise: 0.5
      variation:
        seed_mode: "semi-fixed"
        jitter: {cfg: 0.15, steps: 2, denoise: 0.03}

  nsfw.closeup:
    prefer_bases: ["juggernaut_xl_v9"]
    allow_refiner: true
    loras: ["faceid_sdxl", "face_helper_sdxl", "eyes_iris_width_xl"]
    defaults:
      cfg: 5.1
      steps: 30
      denoise: 0.65
      variation:
        seed_mode: "semi-fixed"
        jitter: {cfg: 0.3, steps: 2, denoise: 0.05}

  general:
    prefer_bases: ["juggernaut_xl_v9", "sdxl_base_1_0"]
    allow_refiner: false
    loras: []
    defaults:
      cfg: 5.0
      steps: 28
      denoise: 0.7
      variation:
        seed_mode: "random"
        jitter: {cfg: 0.4, steps: 5, denoise: 0.06}
